# 移动端 MVP 说明

## 实现范围
- 在登录、文档列表、协同编辑、通知页面增加移动端 `<meta viewport>` 与独立样式 `/static/mobile.css`，提供卡片式列表、底部浮动操作与安全区域适配。
- 编辑页为 Quill 添加精简工具栏（粗体/斜体/下划线、标题、列表、更多菜单）并提供底部“保存/同步”按钮与同步状态条。
- 文档 API 返回 `latest_revision_id`，新增 `/api/v1/documents/{id}/sync` 接口用于带基线校验的同步，WebSocket 初始化与内容更新附带 revision 信息并支持重连心跳。
- 新增前端离线草稿模块 `static/offline_drafts.js`（IndexedDB 优先，localStorage 兜底），支持离线保存、恢复、在线后同步或冲突处理（覆盖/复制/放弃）。
- 文档列表增加悬浮新建 FAB、通知铃铛与未读角标、通知列表筛选。

## 离线同步策略
1. 编辑时每 3s 防抖写入本地草稿，记录 `base_revision_id` 与本地时间。
2. 进入页面或恢复前台时尝试拉取服务器最新内容并更新基线。
3. 离线 -> 在线后：
   - 若草稿基线与服务器一致，则通过 `/api/v1/documents/{id}/sync` 提交并清除草稿。
   - 若冲突则弹出 3 选 1：覆盖服务器（直接 PUT 保存）、复制为新文档（标题追加 `(offline copy)`）、放弃草稿。
4. 用户可手动“保存/同步”强制落库并刷新基线。

## 通讯降级说明
- 移动端不提供 IM/音视频/文件共享，改为评论/@ 与通知：
  - WebSocket 继续同步正文；
  - 评论区保留，用于讨论与 @；
  - 通知中心支持未读过滤、点击已读。
- 详细 IM 能力、文件分发不在此 MVP 中实现。

## 手工测试步骤
1. **移动访问链路**：手机竖屏打开首页 → 登录 → 查看文档列表 → 点击 FAB 新建文档 → 进入编辑页，确认底部工具栏可用且无横向滚动。
2. **同步与重连**：两台设备同时编辑同一文档，断开一端网络后编辑，恢复网络应自动重连并拉取最新内容；查看同步状态条提示。
3. **离线草稿**：断网后继续编辑，刷新页面或恢复网络后触发冲突提示并按三种策略分别验证。
4. **通知**：登录后点击铃铛展开通知列表，切换“未读”筛选并标记已读。
5. **安全区域**：iOS 刘海屏下底部工具栏与 FAB 不被遮挡。
