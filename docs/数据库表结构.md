# 数据库表结构

## 1. 用户表 (users)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | String(50) | UNIQUE, INDEX, NOT NULL | 用户名 |
| email | String(100) | UNIQUE, INDEX | 邮箱地址 |
| phone | String(20) | UNIQUE, INDEX | 手机号 |
| hashed_password | String(255) | NOT NULL | 密码哈希值 |
| is_active | Boolean | DEFAULT=True | 账户是否激活 |
| role | String(20) | DEFAULT="viewer" | 用户角色：admin/editor/viewer |
| avatar_url | String(500) | | 头像URL |
| full_name | String(100) | | 全名 |
| bio | Text | | 个人简介 |
| address | String(500) | | 地址 |
| phone_secondary | String(20) | | 备用电话 |
| password_reset_token | String(255) | | 密码重置令牌 |
| password_reset_expires | DateTime | | 密码重置过期时间 |
| verification_code | String(10) | | 验证码 |
| verification_code_expires | DateTime | | 验证码过期时间 |
| created_at | DateTime | NOT NULL, DEFAULT=now() | 创建时间 |
| updated_at | DateTime | NOT NULL, DEFAULT=now(), ONUPDATE=now() | 更新时间 |

## 2. 文档表 (documents)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, AUTO_INCREMENT | 文档ID |
| owner_id | Integer | FOREIGN KEY(users.id), NOT NULL | 文档所有者ID |
| title | String(200) | INDEX, NOT NULL | 文档标题 |
| content | Text | NOT NULL, DEFAULT="" | 文档内容 |
| status | String(50) | DEFAULT="active" | 文档状态：active/archived |
| created_at | DateTime | NOT NULL, DEFAULT=now() | 创建时间 |
| updated_at | DateTime | NOT NULL, DEFAULT=now(), ONUPDATE=now() | 更新时间 |

## 3. 文档版本表 (document_versions)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, AUTO_INCREMENT | 版本ID |
| document_id | Integer | FOREIGN KEY(documents.id), NOT NULL | 文档ID |
| user_id | Integer | FOREIGN KEY(users.id), NOT NULL | 创建版本的用户ID |
| version_number | Integer | NOT NULL | 版本号 |
| content_snapshot | Text | NOT NULL | 内容快照 |
| summary | String(500) | | 变更摘要 |
| created_at | DateTime | NOT NULL, DEFAULT=now() | 创建时间 |

## 4. 操作日志表 (operation_logs)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, AUTO_INCREMENT | 日志ID |
| user_id | Integer | FOREIGN KEY(users.id), NOT NULL | 操作用户ID |
| action | String(100) | NOT NULL | 操作类型：login, logout, create_document, update_document等 |
| resource_type | String(50) | | 资源类型：document, user等 |
| resource_id | Integer | | 资源ID |
| description | Text | | 操作描述 |
| ip_address | String(50) | | IP地址 |
| user_agent | String(500) | | 用户代理 |
| created_at | DateTime | NOT NULL, DEFAULT=now() | 创建时间 |

## 5. 权限表 (permissions)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, AUTO_INCREMENT | 权限ID |
| name | String(100) | UNIQUE, NOT NULL | 权限名称：read_document, write_document等 |
| description | Text | | 权限描述 |
| resource_type | String(50) | | 资源类型：document, user, system |
| created_at | DateTime | NOT NULL, DEFAULT=now() | 创建时间 |

## 6. 角色权限关联表 (role_permissions)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, AUTO_INCREMENT | 关联ID |
| role | String(20) | NOT NULL | 角色：admin, editor, viewer |
| permission_id | Integer | FOREIGN KEY(permissions.id), NOT NULL | 权限ID |
| created_at | DateTime | NOT NULL, DEFAULT=now() | 创建时间 |

## 7. 访问控制列表 (acls)

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| id | Integer | PRIMARY KEY, AUTO_INCREMENT | ACL ID |
| resource_type | String(50) | NOT NULL | 资源类型：document等 |
| resource_id | Integer | NOT NULL | 资源ID |
| user_id | Integer | FOREIGN KEY(users.id) | 用户ID（为空则对所有用户） |
| role | String(20) | | 角色（为空则对所有角色） |
| permission | String(100) | NOT NULL | 权限：read, write, delete等 |
| granted | Boolean | DEFAULT=True | 是否授予权限 |
| created_at | DateTime | NOT NULL, DEFAULT=now() | 创建时间 |
| updated_at | DateTime | NOT NULL, DEFAULT=now(), ONUPDATE=now() | 更新时间 |

## 外键关系

- documents.owner_id → users.id
- document_versions.document_id → documents.id
- document_versions.user_id → users.id
- operation_logs.user_id → users.id
- role_permissions.permission_id → permissions.id
- acls.user_id → users.id