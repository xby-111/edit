--- a/app/api/routers/documents.py
+++ b/app/api/routers/documents.py
@@ -776,7 +776,7 @@ async def update_task_endpoint(
     # 先获取任务信息以检查所属文档
     from app.services.task_service import list_tasks
     # 查询任务获取document_id
-    task_rows = db.query(f"SELECT document_id FROM tasks WHERE id = {task_id} LIMIT 1")
+    task_rows = db.query("SELECT document_id FROM tasks WHERE id = %s LIMIT 1", (task_id,))
     if not task_rows:
         raise HTTPException(status_code=404, detail="任务不存在")
     
@@ -823,9 +823,7 @@ async def add_collaborator_endpoint(
     # 检查文档是否存在且用户为所有者
     if not is_document_owner(db, document_id, current_user.id):
         raise HTTPException(status_code=404, detail="文档不存在或无权限")
-    
-    # 从数据库获取用户ID
-    user_rows = db.query(f"SELECT id FROM users WHERE username = {username_safe} LIMIT 1")
+    user_rows = db.query("SELECT id FROM users WHERE username = %s LIMIT 1", (username,))
     
     if not user_rows:
         raise HTTPException(status_code=404, detail="用户不存在")
@@ -931,9 +929,7 @@ async def batch_add_collaborators_endpoint(
         # 检查文档是否存在且用户为所有者
         if not is_document_owner(db, document_id, current_user.id):
             raise HTTPException(status_code=404, detail="文档不存在或无权限")
-        
-        # 从数据库获取用户ID
-        user_rows = db.query(f"SELECT id FROM users WHERE username = {username_safe} LIMIT 1")
+        user_rows = db.query("SELECT id FROM users WHERE username = %s LIMIT 1", (username,))
         
         if not user_rows:
             failed_users.append({"username": username, "reason": "用户不存在"})
--- a/app/services/user_service.py
+++ b/app/services/user_service.py
@@ -88,9 +88,7 @@ def get_user_by_username(db, username: str):
 def get_user_by_username(db, username: str):
     """通过用户名获取用户 - 使用 py-opengauss 的 query 方法"""
-    username_safe = _escape(username)
     # 使用 py-opengauss 的 query 方法查询
-    rows = db.query("SELECT id, username, email, phone, is_active, role, hashed_password, created_at, updated_at FROM users WHERE username = %s LIMIT 1", (username,))
+    rows = db.query("SELECT id, username, email, phone, is_active, role, hashed_password, created_at, updated_at FROM users WHERE username = %s LIMIT 1", (username,))
     
     if rows:
         result = rows[0]  # 取第一行
@@ -109,9 +107,7 @@ def get_user_by_email(db, email: str):
 def get_user_by_email(db, email: str):
     """通过邮箱获取用户 - 使用 py-opengauss 的 query 方法"""
-    email_safe = _escape(email)
     # 使用 py-opengauss 的 query 方法查询
-    rows = db.query("SELECT id, username, email, phone, is_active, role, created_at, updated_at FROM users WHERE email = %s LIMIT 1", (email,))
+    rows = db.query("SELECT id, username, email, phone, is_active, role, created_at, updated_at FROM users WHERE email = %s LIMIT 1", (email,))
     
     if rows:
         result = rows[0]  # 取第一行
@@ -129,9 +125,7 @@ def get_user_by_phone(db, phone: str):
 def get_user_by_phone(db, phone: str):
     """通过手机号获取用户 - 使用 py-opengauss 的 query 方法"""
-    phone_safe = _escape(phone)
     # 使用 py-opengauss 的 query 方法查询
-    rows = db.query("SELECT id, username, email, phone, is_active, role, created_at, updated_at FROM users WHERE phone = %s LIMIT 1", (phone,))
+    rows = db.query("SELECT id, username, email, phone, is_active, role, created_at, updated_at FROM users WHERE phone = %s LIMIT 1", (phone,))
     
     if rows:
         result = rows[0]  # 取第一行
--- a/scripts/smoke_imports.py
+++ b/scripts/smoke_imports.py
@@ -0,0 +1,23 @@
+#!/usr/bin/env python3
+"""
+导入测试脚本 - 验证所有修改后的模块可以正常导入
+"""
+import sys
+import os
+
+# 添加项目根目录到Python路径
+sys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
+
+def test_imports():
+    """测试关键模块导入"""
+    tests = [
+        ("app.services.user_service", "用户服务模块"),
+        ("app.services.websocket_service", "WebSocket服务模块"),
+        ("app.api.routers.ws", "WebSocket路由模块"),
+        ("app.core.security", "安全模块"),
+        ("app.db.session", "数据库会话模块"),
+    ]
+    
+    success_count = 0
+    total_count = len(tests)
+    
+    for module_name, description in tests:
+        try:
+            __import__(module_name)
+            print(f"✅ {description} ({module_name}) - 导入成功")
+            success_count += 1
+        except Exception as e:
+            print(f"❌ {description} ({module_name}) - 导入失败: {e}")
+    
+    print(f"\n导入测试完成: {success_count}/{total_count} 成功")
+    return success_count == total_count
+
+if __name__ == "__main__":
+    success = test_imports()
+    sys.exit(0 if success else 1)