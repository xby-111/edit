INFO:     Started server process [21804]
INFO:     Waiting for application startup.
INFO:app.db.init_db:开始初始化数据库...
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
WARNING:app.db.session:使用全局连接，仅建议用于脚本等非并发场景
INFO:app.db.init_db:数据库连接成功
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
DEBUG:    = connection is CONNECTING
DEBUG:    < GET /api/v1/ws/notifications?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ3c25vdGlmeTFfODZkODBmIiwiZXhwIjoxNzY0MTY0ODExfQ.C4LWw9s7TRtD63ia1WjlvdHdMkOxgeyjTqzXYlLvdYM HTTP/1.1
DEBUG:    < host: 127.0.0.1:8000
DEBUG:    < upgrade: websocket
DEBUG:    < connection: Upgrade
DEBUG:    < sec-websocket-key: ZaDfN/FQYH+q0faIbfZRew==
DEBUG:    < sec-websocket-version: 13
DEBUG:    < sec-websocket-extensions: permessage-deflate; client_max_window_bits
DEBUG:    < user-agent: Python/3.10 websockets/15.0.1
INFO:     127.0.0.1:5078 - "WebSocket /api/v1/ws/notifications?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ3c25vdGlmeTFfODZkODBmIiwiZXhwIjoxNzY0MTY0ODExfQ.C4LWw9s7TRtD63ia1WjlvdHdMkOxgeyjTqzXYlLvdYM" [accepted]
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.services.notification_ws_manager:通知WebSocket连接: user_id=58
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
DEBUG:    > HTTP/1.1 101 Switching Protocols
DEBUG:    > Upgrade: websocket
DEBUG:    > Connection: Upgrade
DEBUG:    > Sec-WebSocket-Accept: dDK76azUO5IhzVNar//KdCv8l7Q=
DEBUG:    > Sec-WebSocket-Extensions: permessage-deflate
DEBUG:    > date: Wed, 26 Nov 2025 13:16:51 GMT
DEBUG:    > server: uvicorn
INFO:     connection open
DEBUG:    = connection is OPEN
DEBUG:    > TEXT '{"type":"init","data":[]}' [25 bytes]
DEBUG:    = connection is CONNECTING
DEBUG:    < GET /api/v1/ws/notifications?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ3c25vdGlmeTJfMGRlOTllIiwiZXhwIjoxNzY0MTY0ODEyfQ.JB4V9OcmWbwBH6gak0bL7yNs257wyno4kEheeWB5Zgg HTTP/1.1
DEBUG:    < host: 127.0.0.1:8000
DEBUG:    < upgrade: websocket
DEBUG:    < connection: Upgrade
DEBUG:    < sec-websocket-key: Fhs8Ll4o9zgeO3erpMDM0w==
DEBUG:    < sec-websocket-version: 13
DEBUG:    < sec-websocket-extensions: permessage-deflate; client_max_window_bits
DEBUG:    < user-agent: Python/3.10 websockets/15.0.1
INFO:     127.0.0.1:5086 - "WebSocket /api/v1/ws/notifications?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ3c25vdGlmeTJfMGRlOTllIiwiZXhwIjoxNzY0MTY0ODEyfQ.JB4V9OcmWbwBH6gak0bL7yNs257wyno4kEheeWB5Zgg" [accepted]
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.services.notification_ws_manager:通知WebSocket连接: user_id=59
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
DEBUG:    > HTTP/1.1 101 Switching Protocols
DEBUG:    > Upgrade: websocket
DEBUG:    > Connection: Upgrade
DEBUG:    > Sec-WebSocket-Accept: 2fDJAZJNpyfIw/kpvWMH48M2zFc=
DEBUG:    > Sec-WebSocket-Extensions: permessage-deflate
DEBUG:    > date: Wed, 26 Nov 2025 13:16:51 GMT
DEBUG:    > server: uvicorn
INFO:     connection open
DEBUG:    = connection is OPEN
DEBUG:    > TEXT '{"type":"init","data":[]}' [25 bytes]
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
INFO:app.db.session:尝试连接数据库 (尝试 1/3): host=120.46.143.126, port=5432, user=appuser, database=editdb
INFO:app.db.session:openGauss 连接创建成功
ERROR:asyncio:Task exception was never retrieved
future: <Task finished name='Task-46' coro=<WebSocket.send_json() done, defined at D:\Python310\lib\site-packages\starlette\websockets.py:171> exception=TypeError('Object of type datetime is not JSON serializable')>
Traceback (most recent call last):
  File "D:\Python310\lib\site-packages\starlette\websockets.py", line 174, in send_json
    text = json.dumps(data, separators=(",", ":"), ensure_ascii=False)
  File "D:\Python310\lib\json\__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "D:\Python310\lib\json\encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "D:\Python310\lib\json\encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "D:\Python310\lib\json\encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type datetime is not JSON serializable
DEBUG:    < CLOSE 1000 (OK) [2 bytes]
DEBUG:    = connection is CLOSING
DEBUG:    > CLOSE 1000 (OK) [2 bytes]
DEBUG:    x half-closing TCP connection
DEBUG:    = connection is CLOSED
INFO:     connection closed
DEBUG:    < CLOSE 1000 (OK) [2 bytes]
DEBUG:    = connection is CLOSING
DEBUG:    > CLOSE 1000 (OK) [2 bytes]
DEBUG:    x half-closing TCP connection
DEBUG:    = connection is CLOSED
INFO:     connection closed
